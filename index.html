<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>想起トレ（単語ペア）</title>
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="#111111">
</head>
<body>
  <header class="app-header">
    <div class="title">
      <h1>想起トレ（単語ペア）</h1>
      <p class="subtitle">20/40ペア × 15/30/45/60秒 × 難易度 低/中/高（抽象語ミックス可） <span class="ver">v8</span></p>
    </div>
    <button id="installBtn" class="ghost" hidden>ホーム画面に追加</button>
  </header>

  <main class="container">
    <section class="card" id="setupCard">
      <h2>設定</h2>

      <div class="grid">
        <label class="field">
          <span>ペア数</span>
          <select id="pairCount">
            <option value="20" selected>20ペア</option>
            <option value="40">40ペア</option>
          </select>
        </label>

        <label class="field">
          <span>記憶タイマー</span>
          <select id="memorizeSeconds">
            <option value="15">15秒</option>
            <option value="30" selected>30秒</option>
            <option value="45">45秒</option>
            <option value="60">60秒</option>
          </select>
        </label>

        <label class="field">
          <span>出題</span>
          <select id="mode">
            <option value="memorize_then_recall" selected>記憶 → 想起</option>
            <option value="recall_only">想起のみ</option>
          </select>
        </label>

        <label class="field">
          <span>難易度（語彙プール）</span>
          <select id="difficulty">
            <option value="low" selected>低（具体語）</option>
            <option value="mid">中（半抽象）</option>
            <option value="high">高（抽象多め）</option>
          </select>
        </label>

        <label class="field">
          <span>抽象語ミックス</span>
          <select id="mixAbstract">
            <option value="0" selected>OFF</option>
            <option value="0.2">ON（20%）</option>
            <option value="0.35">ON（35%）</option>
            <option value="0.5">ON（50%）</option>
</select>
        </label>

        <label class="field">
          <span>単語セット</span>
          <select id="wordSource">
            <option value="files" selected>辞書ファイル（low/mid/high/abs）</option>
            <option value="custom">自分の単語リスト（貼り付け）</option>
          </select>
        </label>
      </div>

      <details id="customWordsWrap" class="custom-words" hidden>
        <summary>自分の単語リストを貼り付け（任意）</summary>
        <p class="hint">
          1行に1単語（日本語）。このモードでは難易度分けは無視され、このリストからランダムにペアを作ります。
        </p>
        <textarea id="customWords" rows="8" placeholder="（ここに貼り付け）"></textarea>
        <div class="row">
          <button id="saveCustomWords" class="ghost">保存</button>
          <button id="clearCustomWords" class="ghost danger">削除</button>
        </div>
      </details>

      <details class="custom-words">
        <summary>辞書ファイルについて（1万語版にする方法）</summary>
        <p class="hint">
          リポジトリ直下に以下のファイルを置くと、その内容が使われます（1行1単語）。<br>
          words_low.txt / words_mid.txt / words_high.txt / words_abs.txt<br>
          例：低5000・中3000・高2000・抽象語別
        </p>
      </details>

      <div class="row">
        <button id="startBtn" class="primary">開始</button>
        <button id="continueBtn" class="ghost" hidden>前回の続きを開く</button>
      </div>

      <p class="note">
        コツ：正答率より「想起を開始する回数」が大事です。3秒で出なければスキップOK。
      </p>
    </section>

    <section class="card" id="memorizeCard" hidden>
      <div class="topline">
        <h2>記憶フェーズ</h2>
        <div class="timer"><span id="timerLabel">00:00</span></div>
      </div>
      <p class="hint">時間内に全体をざっと見てください（覚えきれなくてOK）。</p>
      <div class="table-wrap">
        <table class="pairs">
          <thead>
            <tr><th>#</th><th>左</th><th>右</th></tr>
          </thead>
          <tbody id="memorizeTable"></tbody>
        </table>
      </div>
      <div class="row">
        <button id="toRecallBtn" class="primary">想起へ</button>
        <button id="restartBtn1" class="ghost">最初から</button>
      </div>
    </section>

    <section class="card" id="recallCard" hidden>
      <div class="topline">
        <h2>想起フェーズ</h2>
        <div class="pill" id="progressPill">0/0</div>
      </div>
      <p class="hint">左だけ見て、右を入力。3秒で出なければ空欄で次へ。</p>

      <div class="table-wrap">
        <table class="pairs">
          <thead>
            <tr><th>#</th><th>左</th><th>入力（右）</th></tr>
          </thead>
          <tbody id="recallTable"></tbody>
        </table>
      </div>

      <div class="row">
        <button id="checkBtn" class="primary">答え合わせ</button>
        <button id="showAnswersBtn" class="ghost">答えを表示</button>
        <button id="restartBtn2" class="ghost">最初から</button>
      </div>
    </section>

    <section class="card" id="resultCard" hidden>
      <div class="topline">
        <h2>結果</h2>
        <div class="pill" id="scorePill">-</div>
      </div>

      <div class="result-grid">
        <div class="metric"><div class="k">正解</div><div class="v" id="correctCount">-</div></div>
        <div class="metric"><div class="k">合計</div><div class="v" id="totalCount">-</div></div>
        <div class="metric"><div class="k">正答率</div><div class="v" id="accuracy">-</div></div>
      </div>

      <details class="review">
        <summary>採点の詳細（入力と正解）</summary>
        <div class="table-wrap">
          <table class="pairs">
            <thead>
              <tr><th>#</th><th>ペア（左）</th><th>あなたの回答</th><th>正解</th><th>判定</th></tr>
            </thead>
            <tbody id="reviewTable"></tbody>
          </table>
        </div>
      </details>

      <div class="row">
        <button id="newSetBtn" class="primary">次のセット</button>
        <button id="backToSetupBtn" class="ghost">設定に戻る</button>
      </div>
    </section>

    <section class="card" id="historyCard">
      <div class="topline">
        <h2>履歴（端末内）</h2>
        <button id="clearHistoryBtn" class="ghost danger">履歴を消す</button>
      </div>
      <div class="table-wrap">
        <table class="pairs">
          <thead>
            <tr><th>日時</th><th>ペア数</th><th>タイマー</th><th>難易度</th><th>抽象</th><th>正答率</th><th>正解/合計</th></tr>
          </thead>
          <tbody id="historyTable"></tbody>
        </table>
      </div>
      <p class="hint">※履歴はこの端末のブラウザに保存されます（外部送信なし）。</p>
    </section>
  </main>

  <footer class="footer">
    <small>オフライン対応（PWA）。データは端末内に保存。 <b>v8</b></small>
  </footer>

  <script src="app.v8.js"></script>
</body>
</html>
